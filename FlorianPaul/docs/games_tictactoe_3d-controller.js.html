<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>games/tictactoe/3d-controller.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Agent.html">Agent</a><ul class='methods'><li data-type='method'><a href="Agent.html#getAction">getAction</a></li></ul></li><li><a href="AlgorithmRunner.html">AlgorithmRunner</a><ul class='methods'><li data-type='method'><a href="AlgorithmRunner.html#setSpeed">setSpeed</a></li><li data-type='method'><a href="AlgorithmRunner.html#start">start</a></li><li data-type='method'><a href="AlgorithmRunner.html#stop">stop</a></li><li data-type='method'><a href="AlgorithmRunner.html#triggerStep">triggerStep</a></li></ul></li><li></li><li><a href="Arena.html">Arena</a><ul class='methods'><li data-type='method'><a href="Arena.html#runSeries">runSeries</a></li></ul></li><li></li><li><a href="AtomicRule.html">AtomicRule</a></li><li><a href="Benchmark.html">Benchmark</a><ul class='methods'><li data-type='method'><a href="Benchmark.html#getAverage">getAverage</a></li><li data-type='method'><a href="Benchmark.html#getDuration">getDuration</a></li><li data-type='method'><a href="Benchmark.html#record">record</a></li><li data-type='method'><a href="Benchmark.html#reset">reset</a></li><li data-type='method'><a href="Benchmark.html#start">start</a></li><li data-type='method'><a href="Benchmark.html#stop">stop</a></li></ul></li><li><a href="ConditionNode.html">ConditionNode</a></li><li><a href="DecisionTree.html">DecisionTree</a></li><li><a href="FlowchartVisualizer.html">FlowchartVisualizer</a></li><li><a href="GameState.html">GameState</a><ul class='methods'><li data-type='method'><a href="GameState.html#clone">clone</a></li><li data-type='method'><a href="GameState.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="GameState.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="GameState.html#makeMove">makeMove</a></li></ul></li><li><a href="KnightBoard.html">KnightBoard</a><ul class='methods'><li data-type='method'><a href="KnightBoard.html#_getMovesFrom">_getMovesFrom</a></li><li data-type='method'><a href="KnightBoard.html#clone">clone</a></li><li data-type='method'><a href="KnightBoard.html#getDegree">getDegree</a></li><li data-type='method'><a href="KnightBoard.html#getNextStates">getNextStates</a></li><li data-type='method'><a href="KnightBoard.html#getPossibleMoves">getPossibleMoves</a></li><li data-type='method'><a href="KnightBoard.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="KnightBoard.html#initGrid">initGrid</a></li><li data-type='method'><a href="KnightBoard.html#isGoal">isGoal</a></li><li data-type='method'><a href="KnightBoard.html#isInside">isInside</a></li><li data-type='method'><a href="KnightBoard.html#isValidMove">isValidMove</a></li><li data-type='method'><a href="KnightBoard.html#move">move</a></li><li data-type='method'><a href="KnightBoard.html#undo">undo</a></li></ul></li><li><a href="RandomAgent.html">RandomAgent</a><ul class='methods'><li data-type='method'><a href="RandomAgent.html#getAction">getAction</a></li></ul></li><li><a href="RotateBoard.html">RotateBoard</a><ul class='methods'><li data-type='method'><a href="RotateBoard.html#canFall">canFall</a></li><li data-type='method'><a href="RotateBoard.html#clone">clone</a></li><li data-type='method'><a href="RotateBoard.html#getNextStates">getNextStates</a></li><li data-type='method'><a href="RotateBoard.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="RotateBoard.html#initFromId">initFromId</a></li><li data-type='method'><a href="RotateBoard.html#isGoal">isGoal</a></li><li data-type='method'><a href="RotateBoard.html#moveDown">moveDown</a></li><li data-type='method'><a href="RotateBoard.html#relaxBoardSync">relaxBoardSync</a></li><li data-type='method'><a href="RotateBoard.html#rotate">rotate</a></li></ul></li><li><a href="RuleBasedAgent.html">RuleBasedAgent</a><ul class='methods'><li data-type='method'><a href="RuleBasedAgent.html#getAction">getAction</a></li></ul></li><li></li><li><a href="RuleGroup.html">RuleGroup</a></li><li><a href="RuleNode.html">RuleNode</a><ul class='methods'><li data-type='method'><a href="RuleNode.html#evaluate">evaluate</a></li></ul></li><li><a href="RuleVisualizer.html">RuleVisualizer</a></li><li><a href="SearchEngine.html">SearchEngine</a><ul class='methods'><li data-type='method'><a href="SearchEngine.html#solve">solve</a></li></ul></li><li></li><li><a href="TTT3DBoard.html">TTT3DBoard</a><ul class='methods'><li data-type='method'><a href="TTT3DBoard.html#checkWin">checkWin</a></li><li data-type='method'><a href="TTT3DBoard.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="TTT3DBoard.html#makeMove">makeMove</a></li><li data-type='method'><a href="TTT3DBoard.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="TTTBase.html">TTTBase</a><ul class='methods'><li data-type='method'><a href="TTTBase.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="TTTRegularBoard.html">TTTRegularBoard</a><ul class='methods'><li data-type='method'><a href="TTTRegularBoard.html#checkWin">checkWin</a></li><li data-type='method'><a href="TTTRegularBoard.html#clone">clone</a></li><li data-type='method'><a href="TTTRegularBoard.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="TTTRegularBoard.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="TTTRegularBoard.html#makeMove">makeMove</a></li><li data-type='method'><a href="TTTRegularBoard.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="TreeNode.html">TreeNode</a></li><li><a href="TreeVisualizer.html">TreeVisualizer</a><ul class='methods'><li data-type='method'><a href="TreeVisualizer.html#drawTree">drawTree</a></li></ul></li><li><a href="UltimateBoard.html">UltimateBoard</a><ul class='methods'><li data-type='method'><a href="UltimateBoard.html#_checkSmallWin">_checkSmallWin</a></li><li data-type='method'><a href="UltimateBoard.html#_isBoardFullOrWon">_isBoardFullOrWon</a></li><li data-type='method'><a href="UltimateBoard.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="UltimateBoard.html#makeMove">makeMove</a></li><li data-type='method'><a href="UltimateBoard.html#switchPlayer">switchPlayer</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#animateRelax">animateRelax</a></li><li><a href="global.html#checkSmallWin">checkSmallWin</a></li><li><a href="global.html#createStrategyTree">createStrategyTree</a></li><li><a href="global.html#drawRotateBoard">drawRotateBoard</a></li><li><a href="global.html#solveBFS">solveBFS</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">games/tictactoe/3d-controller.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview Controller für 3D Tic-Tac-Toe.
 * Verwaltet User Input, KI-Turns und Rendering.
 */
const ThreeDController = {
    game: null, 
    canvas: null, 
    isoCanvas: null, 
    axis: 'z', 
    size: 3, 
    isProcessing: false,

    /** Initialisiert das Spiel. */
    init() {
        this.canvas = document.getElementById('gameCanvas');
        this.isoCanvas = document.getElementById('isoCanvas');
        this.canvas.addEventListener('mousedown', (e) => this.click(e));
        
        // KI Dropdowns überwachen
        document.getElementById('p1Type').onchange = () => this.checkTurn();
        document.getElementById('p2Type').onchange = () => this.checkTurn();
        this.reset();
    },

    /** Ändert die Brettgröße (3 oder 4). */
    setSize(s) {
        this.size = s;
        document.querySelectorAll('.size-btn').forEach(b => {
            b.classList.remove('active');
            if(b.innerText.includes(s)) b.classList.add('active');
        });
        this.reset();
    },

    /** Ändert die Ansichtsachse. */
    setAxis(a) {
        this.axis = a;
        document.querySelectorAll('.view-btn').forEach(b => {
            b.classList.remove('active');
            // Einfacher String-Check für Button-Highlighting
            if(b.innerText.toLowerCase().includes(a === 'z' ? 'oben' : a === 'y' ? 'vorne' : 'seite')) b.classList.add('active');
        });
        this.draw();
    },

    /** Resettet das Spiel. */
    reset() {
        this.game = new TTT3DBoard(this.size);
        this.isProcessing = false;
        this.updateUI(); 
        this.draw(); 
        this.checkTurn();
    },

    /** Prüft, ob eine KI am Zug ist. */
    checkTurn() {
        if(this.game.winner || this.game.getAllValidMoves().length===0) return this.updateUI();
        
        const p1 = document.getElementById('p1Type').value;
        const p2 = document.getElementById('p2Type').value;
        const current = (this.game.currentPlayer === 1) ? p1 : p2;
        this.updateUI();

        if (current !== 'human') {
            this.isProcessing = true;
            const speed = document.getElementById('aiSpeed').value;
            setTimeout(() => {
                // KI Instanzieren (Random oder Regel)
                const agent = (current==='random') ? new RandomAgent() : new RuleBasedAgent(createStrategyTree('3d'));
                const action = agent.getAction(this.game);
                
                if(action) this.game.makeMove(action.move);
                
                this.isProcessing = false;
                this.draw(); 
                this.checkTurn();
            }, speed);
        }
    },

    /** Verarbeitet Klicks auf das Canvas. */
    click(e) {
        if(this.isProcessing || this.game.winner) return;
        
        // --- INPUT SCALING FIX ---
        const rect = this.canvas.getBoundingClientRect();
        
        // Verhältnis Canvas-Pixel zu Display-Pixel
        const scaleX = this.canvas.width / rect.width;
        const scaleY = this.canvas.height / rect.height;

        // Mausposition im Canvas-Koordinatensystem
        const mx = (e.clientX - rect.left) * scaleX;
        const my = (e.clientY - rect.top) * scaleY;
        
        // Layout-Konstanten (identisch zum Renderer)
        const w = this.canvas.width, h = this.canvas.height, s = this.size;
        const pad = 20;
        const availW = w - (pad*2);
        const availH = h - (pad*2);
        const boxSize = Math.min(availW / s, availH);
        const gap = boxSize * 0.1;
        const boardS = boxSize - gap; // Effektive Brettgröße
        const startX = (w - s*boxSize)/2 + gap/2;
        const startY = (h - boardS)/2 + 10;

        // Hit-Testing: Welches Slice (k)?
        for(let k=0; k&lt;s; k++) {
            const ox = startX + k*boxSize;
            // Prüfen ob Klick im Bereich dieses Boards liegt
            if(mx >= ox &amp;&amp; mx &lt;= ox+boardS &amp;&amp; my >= startY &amp;&amp; my &lt;= startY+boardS) {
                // Zeile und Spalte berechnen
                const c = Math.floor((mx-ox)/(boardS/s));
                const r = Math.floor((my-startY)/(boardS/s));
                
                // Mapping auf 3D Koordinaten
                let x,y,z;
                if(this.axis==='z') { z=k; y=r; x=c; }
                else if(this.axis==='y') { y=k; x=c; z=(s-1)-r; }
                else { x=k; y=c; z=(s-1)-r; }

                // Index berechnen
                const idx = z*(s*s) + y*s + x;
                
                // Zug ausführen
                if(this.game.makeMove(idx)) { 
                    this.draw(); 
                    this.checkTurn(); 
                }
                break;
            }
        }
    },

    updateUI() {
        const stats = document.getElementById('statusText');
        if(this.game.winner) stats.innerText = "SIEG: " + (this.game.winner===1?"BLAU":"ROT");
        else stats.innerText = (this.game.currentPlayer===1?"BLAU":"ROT") + " ist dran";
    },
    
    draw() {
        TTTRenderer.draw3DSlices(this.canvas, this.game, this.axis);
        TTTRenderer.drawIsoView(this.isoCanvas, this.game);
    }
};
window.onload = () => ThreeDController.init();</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Mon Jan 26 2026 19:49:05 GMT+0100 (Central European Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
