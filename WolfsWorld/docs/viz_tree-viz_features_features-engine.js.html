<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>viz/tree-viz/features/features-engine.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Agent.html">Agent</a><ul class='methods'><li data-type='method'><a href="Agent.html#getAction">getAction</a></li></ul></li><li><a href="AlgorithmRunner.html">AlgorithmRunner</a><ul class='methods'><li data-type='method'><a href="AlgorithmRunner.html#setSpeed">setSpeed</a></li><li data-type='method'><a href="AlgorithmRunner.html#start">start</a></li><li data-type='method'><a href="AlgorithmRunner.html#stop">stop</a></li><li data-type='method'><a href="AlgorithmRunner.html#triggerStep">triggerStep</a></li></ul></li><li></li><li><a href="AlphaBetaTreeAdapter.html">AlphaBetaTreeAdapter</a><ul class='methods'><li data-type='method'><a href="AlphaBetaTreeAdapter.html#checkNodeStatus">checkNodeStatus</a></li><li data-type='method'><a href="AlphaBetaTreeAdapter.html#checkParentPruning">checkParentPruning</a></li><li data-type='method'><a href="AlphaBetaTreeAdapter.html#evaluateNode">evaluateNode</a></li><li data-type='method'><a href="AlphaBetaTreeAdapter.html#expandNodeChildren">expandNodeChildren</a></li></ul></li><li><a href="AtomicRule.html">AtomicRule</a></li><li><a href="BFSTreeAdapter.html">BFSTreeAdapter</a><ul class='methods'><li data-type='method'><a href="BFSTreeAdapter.html#buildToDepth">buildToDepth</a></li><li data-type='method'><a href="BFSTreeAdapter.html#focusNode">focusNode</a></li><li data-type='method'><a href="BFSTreeAdapter.html#getNodeCount">getNodeCount</a></li><li data-type='method'><a href="BFSTreeAdapter.html#getStats">getStats</a></li><li data-type='method'><a href="BFSTreeAdapter.html#highlightPath">highlightPath</a></li><li data-type='method'><a href="BFSTreeAdapter.html#resetView">resetView</a></li><li data-type='method'><a href="BFSTreeAdapter.html#startHandshake">startHandshake</a></li></ul></li><li><a href="BaseGameController.html">BaseGameController</a><ul class='methods'><li data-type='method'><a href="BaseGameController.html#checkTurn">checkTurn</a></li><li data-type='method'><a href="BaseGameController.html#coordsToMove">coordsToMove</a></li><li data-type='method'><a href="BaseGameController.html#createAIAgent">createAIAgent</a></li><li data-type='method'><a href="BaseGameController.html#createGame">createGame</a></li><li data-type='method'><a href="BaseGameController.html#drawGame">drawGame</a></li><li data-type='method'><a href="BaseGameController.html#getAISpeed">getAISpeed</a></li><li data-type='method'><a href="BaseGameController.html#handleCanvasClick">handleCanvasClick</a></li><li data-type='method'><a href="BaseGameController.html#init">init</a></li><li data-type='method'><a href="BaseGameController.html#reset">reset</a></li><li data-type='method'><a href="BaseGameController.html#updateUI">updateUI</a></li></ul></li><li><a href="BaseVisualizer.html">BaseVisualizer</a><ul class='methods'><li data-type='method'><a href="BaseVisualizer.html#canvasToWorld">canvasToWorld</a></li><li data-type='method'><a href="BaseVisualizer.html#drawOverlay">drawOverlay</a></li><li data-type='method'><a href="BaseVisualizer.html#executeCommand">executeCommand</a></li><li data-type='method'><a href="BaseVisualizer.html#render">render</a></li><li data-type='method'><a href="BaseVisualizer.html#resetView">resetView</a></li><li data-type='method'><a href="BaseVisualizer.html#sendToParent">sendToParent</a></li><li data-type='method'><a href="BaseVisualizer.html#worldToCanvas">worldToCanvas</a></li></ul></li><li><a href="Benchmark.html">Benchmark</a><ul class='methods'><li data-type='method'><a href="Benchmark.html#getAverage">getAverage</a></li><li data-type='method'><a href="Benchmark.html#getDuration">getDuration</a></li><li data-type='method'><a href="Benchmark.html#record">record</a></li><li data-type='method'><a href="Benchmark.html#reset">reset</a></li><li data-type='method'><a href="Benchmark.html#start">start</a></li><li data-type='method'><a href="Benchmark.html#stop">stop</a></li></ul></li><li><a href="ConditionNode.html">ConditionNode</a></li><li><a href="Connect43D.html">Connect43D</a></li><li><a href="Connect4Regular.html">Connect4Regular</a><ul class='methods'><li data-type='method'><a href="Connect4Regular.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="Connect4Regular.html#makeMove">makeMove</a></li></ul></li><li><a href="DFSTreeAdapter.html">DFSTreeAdapter</a><ul class='methods'><li data-type='method'><a href="DFSTreeAdapter.html#buildToDepth">buildToDepth</a></li><li data-type='method'><a href="DFSTreeAdapter.html#focusNode">focusNode</a></li><li data-type='method'><a href="DFSTreeAdapter.html#getNodeCount">getNodeCount</a></li><li data-type='method'><a href="DFSTreeAdapter.html#getStats">getStats</a></li><li data-type='method'><a href="DFSTreeAdapter.html#highlightPath">highlightPath</a></li><li data-type='method'><a href="DFSTreeAdapter.html#navigateInGame">navigateInGame</a></li><li data-type='method'><a href="DFSTreeAdapter.html#resetView">resetView</a></li><li data-type='method'><a href="DFSTreeAdapter.html#startHandshake">startHandshake</a></li><li data-type='method'><a href="DFSTreeAdapter.html#visualizeSearch">visualizeSearch</a></li></ul></li><li><a href="DecisionTree.html">DecisionTree</a></li><li><a href="FlowchartVisualizer.html">FlowchartVisualizer</a></li><li><a href="GameAdapter.html">GameAdapter</a><ul class='methods'><li data-type='method'><a href="GameAdapter.html#clone">clone</a></li><li data-type='method'><a href="GameAdapter.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="GameAdapter.html#getBoard">getBoard</a></li><li data-type='method'><a href="GameAdapter.html#getCurrentPlayer">getCurrentPlayer</a></li><li data-type='method'><a href="GameAdapter.html#getRemainingMoves">getRemainingMoves</a></li><li data-type='method'><a href="GameAdapter.html#getState">getState</a></li><li data-type='method'><a href="GameAdapter.html#getValidMoves">getValidMoves</a></li><li data-type='method'><a href="GameAdapter.html#getWinner">getWinner</a></li><li data-type='method'><a href="GameAdapter.html#isGameOver">isGameOver</a></li><li data-type='method'><a href="GameAdapter.html#makeMove">makeMove</a></li></ul></li><li><a href="KnightBoard.html">KnightBoard</a><ul class='methods'><li data-type='method'><a href="KnightBoard.html#_getMovesFrom">_getMovesFrom</a></li><li data-type='method'><a href="KnightBoard.html#clone">clone</a></li><li data-type='method'><a href="KnightBoard.html#getDegree">getDegree</a></li><li data-type='method'><a href="KnightBoard.html#getNextStates">getNextStates</a></li><li data-type='method'><a href="KnightBoard.html#getPossibleMoves">getPossibleMoves</a></li><li data-type='method'><a href="KnightBoard.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="KnightBoard.html#initGrid">initGrid</a></li><li data-type='method'><a href="KnightBoard.html#isGoal">isGoal</a></li><li data-type='method'><a href="KnightBoard.html#isInside">isInside</a></li><li data-type='method'><a href="KnightBoard.html#isUndoMove">isUndoMove</a></li><li data-type='method'><a href="KnightBoard.html#isValidMove">isValidMove</a></li><li data-type='method'><a href="KnightBoard.html#move">move</a></li><li data-type='method'><a href="KnightBoard.html#undo">undo</a></li></ul></li><li><a href="LearningPath.html">LearningPath</a><ul class='methods'><li data-type='method'><a href="LearningPath.html#enableNextButton">enableNextButton</a></li></ul></li><li><a href="MinimaxAgent.html">MinimaxAgent</a><ul class='methods'><li data-type='method'><a href="MinimaxAgent.html#getAction">getAction</a></li></ul></li><li></li><li><a href="MinimaxEngine.html">MinimaxEngine</a><ul class='methods'><li data-type='method'><a href="MinimaxEngine.html#findBestMove">findBestMove</a></li></ul></li><li><a href="MinimaxTreeAdapter.html">MinimaxTreeAdapter</a><ul class='methods'><li data-type='method'><a href="MinimaxTreeAdapter.html#checkNodeStatus">checkNodeStatus</a></li><li data-type='method'><a href="MinimaxTreeAdapter.html#createNode">createNode</a></li><li data-type='method'><a href="MinimaxTreeAdapter.html#evaluateNode">evaluateNode</a></li><li data-type='method'><a href="MinimaxTreeAdapter.html#expandNodeChildren">expandNodeChildren</a></li><li data-type='method'><a href="MinimaxTreeAdapter.html#visualizeSearch">visualizeSearch</a></li></ul></li><li></li><li><a href="NIMGameLogic.html">NIMGameLogic</a><ul class='methods'><li data-type='method'><a href="NIMGameLogic.html#_checkGameEnd">_checkGameEnd</a></li><li data-type='method'><a href="NIMGameLogic.html#clone">clone</a></li><li data-type='method'><a href="NIMGameLogic.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="NIMGameLogic.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="NIMGameLogic.html#makeMove">makeMove</a></li><li data-type='method'><a href="NIMGameLogic.html#toString">toString</a></li></ul></li><li><a href="RandomAgent.html">RandomAgent</a><ul class='methods'><li data-type='method'><a href="RandomAgent.html#getAction">getAction</a></li></ul></li><li><a href="RotateBoard.html">RotateBoard</a><ul class='methods'><li data-type='method'><a href="RotateBoard.html#canFall">canFall</a></li><li data-type='method'><a href="RotateBoard.html#clone">clone</a></li><li data-type='method'><a href="RotateBoard.html#getNextStates">getNextStates</a></li><li data-type='method'><a href="RotateBoard.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="RotateBoard.html#initFromId">initFromId</a></li><li data-type='method'><a href="RotateBoard.html#isGoal">isGoal</a></li><li data-type='method'><a href="RotateBoard.html#moveDown">moveDown</a></li><li data-type='method'><a href="RotateBoard.html#relaxBoardSync">relaxBoardSync</a></li><li data-type='method'><a href="RotateBoard.html#rotate">rotate</a></li></ul></li><li><a href="RuleBasedAgent.html">RuleBasedAgent</a><ul class='methods'><li data-type='method'><a href="RuleBasedAgent.html#getAction">getAction</a></li></ul></li><li></li><li><a href="RuleGroup.html">RuleGroup</a></li><li><a href="RuleNode.html">RuleNode</a><ul class='methods'><li data-type='method'><a href="RuleNode.html#evaluate">evaluate</a></li></ul></li><li><a href="RuleVisualizer.html">RuleVisualizer</a></li><li><a href="SearchEngine.html">SearchEngine</a><ul class='methods'><li data-type='method'><a href="SearchEngine.html#solve">solve</a></li></ul></li><li></li><li><a href="TTT3DBoard.html">TTT3DBoard</a><ul class='methods'><li data-type='method'><a href="TTT3DBoard.html#checkWin">checkWin</a></li><li data-type='method'><a href="TTT3DBoard.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="TTT3DBoard.html#makeMove">makeMove</a></li><li data-type='method'><a href="TTT3DBoard.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="TTTBase.html">TTTBase</a><ul class='methods'><li data-type='method'><a href="TTTBase.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="TTTGameAdapter.html">TTTGameAdapter</a><ul class='methods'><li data-type='method'><a href="TTTGameAdapter.html#clone">clone</a></li><li data-type='method'><a href="TTTGameAdapter.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="TTTGameAdapter.html#makeMove">makeMove</a></li><li data-type='method'><a href="TTTGameAdapter.html#toJSON">toJSON</a></li></ul></li><li><a href="TTTRegularBoard.html">TTTRegularBoard</a><ul class='methods'><li data-type='method'><a href="TTTRegularBoard.html#checkWin">checkWin</a></li><li data-type='method'><a href="TTTRegularBoard.html#clone">clone</a></li><li data-type='method'><a href="TTTRegularBoard.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="TTTRegularBoard.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="TTTRegularBoard.html#makeMove">makeMove</a></li><li data-type='method'><a href="TTTRegularBoard.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="TemplateGameLogic.html">TemplateGameLogic</a><ul class='methods'><li data-type='method'><a href="TemplateGameLogic.html#_checkGameEnd">_checkGameEnd</a></li><li data-type='method'><a href="TemplateGameLogic.html#_isMoveInList">_isMoveInList</a></li><li data-type='method'><a href="TemplateGameLogic.html#clone">clone</a></li><li data-type='method'><a href="TemplateGameLogic.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="TemplateGameLogic.html#getNextStates">getNextStates</a></li><li data-type='method'><a href="TemplateGameLogic.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="TemplateGameLogic.html#isGoal">isGoal</a></li><li data-type='method'><a href="TemplateGameLogic.html#makeMove">makeMove</a></li></ul></li><li><a href="UltimateBoard.html">UltimateBoard</a><ul class='methods'><li data-type='method'><a href="UltimateBoard.html#_checkSmallWin">_checkSmallWin</a></li><li data-type='method'><a href="UltimateBoard.html#_isBoardFull">_isBoardFull</a></li><li data-type='method'><a href="UltimateBoard.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="UltimateBoard.html#makeMove">makeMove</a></li><li data-type='method'><a href="UltimateBoard.html#switchPlayer">switchPlayer</a></li></ul></li><li><a href="ai_minimax.js.html">ai/minimax.js</a></li></ul><h3>Namespaces</h3><ul><li><a href="MinimaxNodeRenderer.html">MinimaxNodeRenderer</a><ul class='methods'><li data-type='method'><a href="MinimaxNodeRenderer.html#.drawMetadata">drawMetadata</a></li><li data-type='method'><a href="MinimaxNodeRenderer.html#.render">render</a></li></ul></li></ul><h3>Interfaces</h3><ul><li><a href="GameState.html">GameState</a><ul class='methods'><li data-type='method'><a href="GameState.html#clone">clone</a></li><li data-type='method'><a href="GameState.html#getAllValidMoves">getAllValidMoves</a></li><li data-type='method'><a href="GameState.html#getNextStates">getNextStates</a></li><li data-type='method'><a href="GameState.html#getStateKey">getStateKey</a></li><li data-type='method'><a href="GameState.html#isGoal">isGoal</a></li><li data-type='method'><a href="GameState.html#makeMove">makeMove</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#DEFAULT_STATUS_CONFIG">DEFAULT_STATUS_CONFIG</a></li><li><a href="global.html#GameFactories">GameFactories</a></li><li><a href="global.html#NodeStatusManager">NodeStatusManager</a></li><li><a href="global.html#StatusConfig">StatusConfig</a></li><li><a href="global.html#TTTGameFactory">TTTGameFactory</a></li><li><a href="global.html#VisualizationUtils">VisualizationUtils</a></li><li><a href="global.html#_convertStyleToRenderFormat">_convertStyleToRenderFormat</a></li><li><a href="global.html#animateRelax">animateRelax</a></li><li><a href="global.html#checkAndMarkDeadEnd">checkAndMarkDeadEnd</a></li><li><a href="global.html#checkSmallWin">checkSmallWin</a></li><li><a href="global.html#createAgentFromProfile">createAgentFromProfile</a></li><li><a href="global.html#createGame">createGame</a></li><li><a href="global.html#createStrategyTree">createStrategyTree</a></li><li><a href="global.html#drawRotateBoard">drawRotateBoard</a></li><li><a href="global.html#evaluateDefault">evaluateDefault</a></li><li><a href="global.html#evaluateTicTacToe">evaluateTicTacToe</a></li><li><a href="global.html#findLowestCommonAncestor">findLowestCommonAncestor</a></li><li><a href="global.html#findPathToRoot">findPathToRoot</a></li><li><a href="global.html#getAvailableGames">getAvailableGames</a></li><li><a href="global.html#getAvailableProfiles">getAvailableProfiles</a></li><li><a href="global.html#getNodeStyle">getNodeStyle</a></li><li><a href="global.html#getProfilesByType">getProfilesByType</a></li><li><a href="global.html#reconstructTreePath">reconstructTreePath</a></li><li><a href="global.html#setActiveNode">setActiveNode</a></li><li><a href="global.html#solveBFS">solveBFS</a></li><li><a href="global.html#updateActiveNodePosition">updateActiveNodePosition</a></li><li><a href="global.html#updateNodeStatus">updateNodeStatus</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">viz/tree-viz/features/features-engine.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @fileoverview TreeFeaturesEngine - Feature-Modul für Node-Styling, Status-Management und Dead-End-Erkennung
 * 
 * WICHTIG: Status-Definitionen und -Designs sind nun zentral in status-config.js definiert.
 * Diese Datei nutzt:
 * - StatusConfig.getStatusTypes() für Priority-basierte Status
 * - StatusConfig.getStyleConfig() für Visual-Styles
 * - STYLE_CONFIG_GLOBAL für Master-Rendering-Effekte
 * 
 * Zentrale Verwaltung aller visuellen Effekte und Node-Eigenschaften:
 * - checkAndMarkDeadEnd(): Erkennung von Sackgassen im Baum
 * - getNodeStyle(): Konsistentes Styling basierend auf Node-Status
 * - updateActiveNodeTracking(): Fokus-Management für aktive Knoten
 * 
 * @author Alexander Wolf
 * @version 1.0
 */
// Make TreeFeaturesEngine global (not const, so it's accessible without window.)
var TreeFeaturesEngine = window.TreeFeaturesEngine || {
    // Safe getters for global STYLE_CONFIG and STYLE_CONFIG_GLOBAL
    // These are defined in status-config.js and must be loaded first
    getStyleConfig() {
        if (typeof window !== 'undefined' &amp;&amp; window.STYLE_CONFIG) {
            return window.STYLE_CONFIG;
        }
        if (typeof StatusConfig !== 'undefined' &amp;&amp; StatusConfig.getStyleConfig) {
            return StatusConfig.getStyleConfig();
        }
        return {};
    },

    getStyleConfigGlobal() {
        if (typeof window !== 'undefined' &amp;&amp; window.STYLE_CONFIG_GLOBAL) {
            return window.STYLE_CONFIG_GLOBAL;
        }
        if (typeof StatusConfig !== 'undefined' &amp;&amp; StatusConfig.STYLE_CONFIG_GLOBAL) {
            return StatusConfig.STYLE_CONFIG_GLOBAL;
        }
        return {};
    },

    /**
     * Identifies whether a node is a dead end and applies the corresponding status.
     * @param {string} nodeId - The ID of the node to check
     * @param {Object} nodes - Map of all nodes in the tree
     */
    checkAndMarkDeadEnd(nodeId, nodes) {
        const node = nodes.get(nodeId);
        
        if (!node) {
            return;
        }
        
        if (!node.children || node.children.length === 0) {
            return;
        }

        // REKURSIV: Prüfe und markiere alle Kinder zuerst!
        for (const childId of node.children) {
            TreeFeaturesEngine.checkAndMarkDeadEnd(childId, nodes);
        }

        // JETZT: Prüfe, ob alle Kinder DEAD_END sind (nachdem sie rekursiv geprüft wurden)
        let allChildrenAreDead = true;
        for (const childId of node.children) {
            const child = nodes.get(childId);
            const hasDeadEnd = child &amp;&amp; child.status &amp;&amp; child.status.has('DEAD_END');
            
            if (!hasDeadEnd) {
                allChildrenAreDead = false;
                break;
            }
        }

        // Wenn alle Kinder DEAD_END sind, markiere diesen Knoten auch
        if (allChildrenAreDead) {
            if (!node.status) node.status = new Set();
            node.status.add('DEAD_END');
        }
    },

    /**
     * Aktualisiert Active Node Tracking
     * Zentriert View auf aktiven Node mit optionaler Animation
     * (Pausiert während Pan/Zoom-Interaktionen)
     * 
     * @param {Object} activeNodeTracking - { nodeId, paused, targetX, targetY, animating, ... }
     * @param {Map} nodes
     * @param {Object} viewport - { offsetX, offsetY, scale }
     * @param {Object} canvas - { width, height }
     * @param {Object} config - { activeNodeTrackingSmooth, activeNodeTrackingDuration }
     */
    updateActiveNodePosition(activeNodeTracking, nodes, viewport, canvas, config) {
        if (!activeNodeTracking.nodeId) return;
        
        // Skip if tracking is paused (during pan/zoom)
        if (activeNodeTracking.paused) return;

        const node = nodes.get(activeNodeTracking.nodeId);
        if (!node) return;

        const targetX = canvas.width * config.activeNodeTargetX;
        const targetY = canvas.height * config.activeNodeTargetY;

        if (config.activeNodeTrackingSmooth &amp;&amp; !activeNodeTracking.animating) {
            // Start animation
            activeNodeTracking.animating = true;
            activeNodeTracking.animationStart = performance.now();
            activeNodeTracking.animationDuration = config.activeNodeTrackingDuration || 300;
            activeNodeTracking.lastOffsetX = viewport.offsetX;
            activeNodeTracking.lastOffsetY = viewport.offsetY;
        }

        if (activeNodeTracking.animating) {
            const now = performance.now();
            const elapsed = now - activeNodeTracking.animationStart;
            const duration = activeNodeTracking.animationDuration;

            if (elapsed >= duration) {
                // Animation finished
                activeNodeTracking.animating = false;
            }

            const progress = Math.min(1, elapsed / duration);
            const easeProgress = 1 - Math.pow(1 - progress, 3);

            const startX = activeNodeTracking.lastOffsetX;
            const startY = activeNodeTracking.lastOffsetY;
            const endOffsetX = targetX - node.x * viewport.scale;
            const endOffsetY = targetY - node.y * viewport.scale;

            viewport.offsetX = startX + (endOffsetX - startX) * easeProgress;
            viewport.offsetY = startY + (endOffsetY - startY) * easeProgress;
        } else {
            // Instant centering
            viewport.offsetX = targetX - node.x * viewport.scale;
            viewport.offsetY = targetY - node.y * viewport.scale;
        }
    },

    /**
     * Setzt den Active Node (exclusive - entfernt ACTIVE von allen anderen)
     * @param {number} nodeId
     * @param {Map} nodes
     * @param {Object} activeNodeTracking
     */
    setActiveNode(nodeId, nodes, activeNodeTracking) {
        if (activeNodeTracking.nodeId === nodeId) return; // Already active

        // REMOVE ACTIVE from all other nodes (exclusive lock)
        nodes.forEach(node => {
            if (node.status &amp;&amp; node.status.has('ACTIVE') &amp;&amp; node.id !== nodeId) {
                node.status.delete('ACTIVE');
            }
        });

        activeNodeTracking.nodeId = nodeId;
        activeNodeTracking.animating = false;

        const node = nodes.get(nodeId);
        if (!node) return;

        // Markiere als ACTIVE (nicht nur Status, sondern auch Tracking-Info)
        if (!node.status) node.status = new Set();
        node.status.add('ACTIVE');
    },

    /**
     * Gibt Style-Objekt für einen Knoten basierend auf Status
     * Kombiniert Status (z.B. ACTIVE + DEAD_END) zu konsistentem Styling
     * 
     * @param {Object} node
     * @param {Object} statusTypes - Status-Definitionen
     * @param {Object} config - Engine config with enableStatusGlow
     * @returns {Object} { glowColor, borderColor, borderWidth, borderDash, fillColor }
     */
    getNodeStyle(node, statusTypes, config = {}) {
        const STYLE_CONFIG = this.getStyleConfig();
        // CUSTOM COLOR SUPPORT: If node has a custom color property (e.g., for Warnsdorf preview nodes)
        if (node.color &amp;&amp; !node.status?.size) {
            const previewStyle = { ...STYLE_CONFIG.PREVIEW_NODE };
            previewStyle.color = node.color;  // Override with custom color
            return this._convertStyleToRenderFormat(previewStyle, config);
        }

        if (!node.status || node.status.size === 0) {
            return this._convertStyleToRenderFormat(STYLE_CONFIG.DEFAULT, config);
        }

        // Combo-Status prüfen (höchste Priorität)
        const hasActive = node.status.has('ACTIVE');
        const hasDeadEnd = node.status.has('DEAD_END');
        const hasWin = node.status.has('WIN');
        const hasDuplicate = node.status.has('DUPLICATE');

        // DUPLICATE: Always takes precedence
        if (hasDuplicate) {
            return this._convertStyleToRenderFormat(STYLE_CONFIG.DUPLICATE, config);
        }

        // Combo-Status
        if (hasActive &amp;&amp; hasDeadEnd) {
            return this._convertStyleToRenderFormat(STYLE_CONFIG.ACTIVE_DEAD_END, config);
        }

        if (hasActive &amp;&amp; hasWin) {
            return this._convertStyleToRenderFormat(STYLE_CONFIG.ACTIVE_WIN, config);
        }

        // Single status (pick first by priority order)
        // EXPLICITLY ADD INTERACTIVE STATUSES (READY, WAIT, EVALUATED)
        // Single status (pick first by priority order)
        // EXPLICITLY ADD INTERACTIVE STATUSES (READY, WAIT, EVALUATED, WIN_BLUE, WIN_RED)
        const priorityOrder = ['ACTIVE', 'READY', 'WIN_BLUE', 'WIN_RED', 'WIN', 'LOSS', 'SOLUTION', 'DEAD_END', 'DRAW', 'PRUNED', 'EVALUATED', 'WAIT', 'NONE'];
        let selectedStyle = STYLE_CONFIG.DEFAULT;
        
        for (const statusName of priorityOrder) {
            if (node.status.has(statusName) &amp;&amp; STYLE_CONFIG[statusName]) {
                selectedStyle = STYLE_CONFIG[statusName];
                break;
            }
        }

        return this._convertStyleToRenderFormat(selectedStyle, config);
    },

    /**
     * Konvertiert STYLE_CONFIG Format zu Renderer-Format
     * Mit Unterstützung für enableGlow und enableDash Schalter
     * Nutzt zentrale STYLE_CONFIG_GLOBAL Effekt-Schalter
     * @param {Object} style - STYLE_CONFIG object
     * @param {Object} config - Renderer config (kompatibilität, wird nicht mehr genutzt)
     * @returns {Object} - Renderer-kompatibles Format
     */
    _convertStyleToRenderFormat(style, config = {}) {
        const STYLE_CONFIG_GLOBAL = this.getStyleConfigGlobal();
        // Nutze zentrale STYLE_CONFIG_GLOBAL Schalter statt einzelner config Optionen
        const enableGlowEffects = STYLE_CONFIG_GLOBAL.enableGlowEffects;
        const enableDashEffects = STYLE_CONFIG_GLOBAL.enableDashEffects;
        
        return {
            fillColor: style.color || null,
            borderColor: style.border || '#333',
            borderWidth: style.width || 2,
            // Glow: Kombiniere globalen Schalter mit lokalem Schalter und Glow-Farbe
            glowColor: (enableGlowEffects &amp;&amp; style.enableGlow &amp;&amp; style.glow) ? style.glow : null,
            // Dash: Kombiniere globalen Schalter mit lokalem Schalter und Dash-Pattern
            borderDash: (enableDashEffects &amp;&amp; style.enableDash &amp;&amp; style.dash) ? style.dash : []
        };

    },

    /**
     * Aktualisiert Node-Status (addStatus, removeStatus, setStatus)
     * @param {Object} node
     * @param {string} status
     * @param {boolean} active - true = add, false = remove
     */
    updateNodeStatus(node, status, active = true) {
        if (!node.status) {
            node.status = new Set();
        }

        if (active) {
            node.status.add(status);
        } else {
            node.status.delete(status);
        }
    }
};

// Make globally available
if (typeof window !== 'undefined') {
    window.TreeFeaturesEngine = TreeFeaturesEngine;
}

// Export for Node.js/CommonJS
if (typeof module !== 'undefined' &amp;&amp; module.exports) {
    module.exports = TreeFeaturesEngine;
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> on Sat Feb 07 2026 23:32:58 GMT+0100 (Central European Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
