<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KI Arena - Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test-section { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 3px solid #3498db; }
        .success { color: green; }
        .error { color: red; }
        button { padding: 10px 15px; margin: 5px; background: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ðŸ¤– KI Arena - Komponenten-Test</h1>

    <div class="test-section">
        <h3>1. Modul-ÃœberprÃ¼fung</h3>
        <div id="moduleChecks"></div>
    </div>

    <div class="test-section">
        <h3>2. Agent-Erstellung</h3>
        <button onclick="testAgentCreation()">Test Agent-Erstellung</button>
        <div id="agentTest"></div>
    </div>

    <div class="test-section">
        <h3>3. Spiel-Erstellung</h3>
        <button onclick="testGameCreation()">Test Spiel-Erstellung</button>
        <div id="gameTest"></div>
    </div>

    <div class="test-section">
        <h3>4. Einzelnes Spiel</h3>
        <button onclick="testSingleGame()">Test 1 Spiel</button>
        <div id="singleGameTest"></div>
    </div>

    <div class="test-section">
        <h3>5. Kleine Simulation</h3>
        <button onclick="testSmallSimulation()">Test 10 Spiele</button>
        <div id="simTest"></div>
    </div>

    <!-- Scripts -->
    <script src="../js/core/agent.js"></script>
    <script src="../js/core/game-state.js"></script>
    <script src="../js/games/tictactoe/logic.js"></script>
    <script src="../js/ai/heuristics.js"></script>
    <script src="../js/ai/minimax.js"></script>
    <script src="../js/ai/agents/minimax-agent.js"></script>
    <script src="../js/ai/agents/rule-based-agent.js"></script>
    <script src="../js/ai/agents/random-agent.js"></script>
    <script src="../js/ai/rules/rule-structure.js"></script>
    <script src="../js/ai/rules/ttt-rules.js"></script>
    <script src="../js/ai/game-adapter.js"></script>
    <script src="../js/ai/agent-profiles.js"></script>
    <script src="../js/ai/arena-controller.js"></script>

    <script>
        // ModulÃ¼berprÃ¼fung
        function checkModules() {
            const checks = [
                { name: 'AgentProfiles', obj: typeof AgentProfiles },
                { name: 'GameFactories', obj: typeof GameFactories },
                { name: 'createAgentFromProfile', obj: typeof createAgentFromProfile },
                { name: 'MinimaxAgent', obj: typeof MinimaxAgent },
                { name: 'RandomAgent', obj: typeof RandomAgent },
                { name: 'RuleBasedAgent', obj: typeof RuleBasedAgent },
                { name: 'TTTGameFactory', obj: typeof TTTGameFactory },
                { name: 'TTTGameAdapter', obj: typeof TTTGameAdapter },
                { name: 'ArenaSimulator', obj: typeof ArenaSimulator }
            ];

            let html = '';
            checks.forEach(check => {
                const isLoaded = check.obj !== 'undefined';
                html += `<div class="${isLoaded ? 'success' : 'error'}">
                    ${isLoaded ? 'âœ“' : 'âœ—'} ${check.name}: ${check.obj}
                </div>`;
            });

            document.getElementById('moduleChecks').innerHTML = html;
        }

        // Test Agent-Erstellung
        function testAgentCreation() {
            const output = document.getElementById('agentTest');
            output.innerHTML = '<p>Teste...</p>';
            
            try {
                const profiles = Object.keys(AgentProfiles).slice(0, 3); // Erste 3
                let html = '<div>';
                
                profiles.forEach(key => {
                    const agent = createAgentFromProfile(key);
                    if (agent) {
                        html += `<div class="success">âœ“ ${key}: ${agent.name}</div>`;
                    } else {
                        html += `<div class="error">âœ— ${key}: Agent ist null</div>`;
                    }
                });
                
                html += '</div>';
                output.innerHTML = html;
            } catch (e) {
                output.innerHTML = `<div class="error">âœ— Fehler: ${e.message}</div>`;
            }
        }

        // Test Spiel-Erstellung
        function testGameCreation() {
            const output = document.getElementById('gameTest');
            output.innerHTML = '<p>Teste...</p>';
            
            try {
                const games = Object.keys(GameFactories);
                let html = '<div>';
                
                games.forEach(key => {
                    const game = GameFactories[key]();
                    if (game && game.board) {
                        html += `<div class="success">âœ“ ${key}: OK (Spieler: ${game.currentPlayer})</div>`;
                    } else {
                        html += `<div class="error">âœ— ${key}: Spiel fehlerhaft</div>`;
                    }
                });
                
                html += '</div>';
                output.innerHTML = html;
            } catch (e) {
                output.innerHTML = `<div class="error">âœ— Fehler: ${e.message}</div>`;
            }
        }

        // Test einzelnes Spiel
        function testSingleGame() {
            const output = document.getElementById('singleGameTest');
            output.innerHTML = '<p>Starte 1 Spiel...</p>';
            
            try {
                const game = GameFactories['TTT Regular']();
                const agent1 = createAgentFromProfile('minimaxBalanced');
                const agent2 = createAgentFromProfile('random');
                
                let moves = 0;
                while (!game.isGameOver && moves < 50) {
                    const agent = game.currentPlayer === 1 ? agent1 : agent2;
                    const action = agent.getAction(game);
                    
                    if (!action || !game.makeMove(action.move)) {
                        break;
                    }
                    moves++;
                }
                
                const result = game.winner || 0;
                let resultText = result === 1 ? 'Agent1 gewinnt' : result === 2 ? 'Agent2 gewinnt' : 'Unentschieden';
                
                output.innerHTML = `<div class="success">
                    âœ“ Spiel beendet nach ${moves} ZÃ¼gen
                    <br/>Gewinner: ${resultText} (Code: ${result})
                    <br/>Board-Winner: ${game.board.winner}
                </div>`;
            } catch (e) {
                output.innerHTML = `<div class="error">âœ— Fehler: ${e.message}<br/>${e.stack}</div>`;
            }
        }

        // Test kleine Simulation
        async function testSmallSimulation() {
            const output = document.getElementById('simTest');
            output.innerHTML = '<p>Starte 10 Spiele...</p>';
            
            try {
                const game = GameFactories['TTT Regular']();
                const agent1 = createAgentFromProfile('minimaxBalanced');
                const agent2 = createAgentFromProfile('random');
                
                const simulator = new ArenaSimulator(agent1, agent2, game);
                const stats = await simulator.runSeries(10, (current, total) => {
                    output.innerHTML = `<p>Spiel ${current}/${total}...</p>`;
                });
                
                output.innerHTML = `<div class="success">
                    âœ“ Simulation beendet!
                    <br/>Blau: ${stats.blueWins} Siege
                    <br/>Rot: ${stats.redWins} Siege
                    <br/>Unentschieden: ${stats.draws}
                    <br/>Durchschnitt ZÃ¼ge: ${(stats.avgMoves).toFixed(1)}
                </div>`;
            } catch (e) {
                output.innerHTML = `<div class="error">âœ— Fehler: ${e.message}<br/>${e.stack}</div>`;
            }
        }

        // Initial
        window.addEventListener('load', checkModules);
    </script>
</body>
</html>
