<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Komplexität von Binärbäumen</title>
    <meta name="course-config" content="course.json">
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/learning-path.css">
    <style>
        .three-col-layout {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 60px);
        }
        .col-left, .col-right { flex: 1; overflow-y: auto; }
        .col-middle { flex: 1.5; overflow-y: auto; padding: 1rem; background: white; border-radius: 8px; }
        .complexity-table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        .complexity-table th, .complexity-table td {
            border: 1px solid #ddd; padding: 0.5rem; text-align: center;
        }
        .complexity-table th { background: #667eea; color: white; }
        .complexity-table input {
            width: 80px; padding: 0.3rem; border: 1px solid #ddd;
            border-radius: 4px; text-align: center;
        }
        .complexity-table input.correct {
            border-color: green; background: #e8f5e9;
        }
        .formula-section { margin: 2rem 0; padding: 1rem; background: #f5f7fa; border-radius: 8px; }
        .formula-input { font-size: 1.1rem; padding: 0.5rem; width: 200px; margin: 0.5rem; }
    </style>
</head>
<body>

<div class="three-col-layout">
    
    <!-- Left Column: Tree Visualization -->
    <div class="col-left">
        <h3 style="margin-top:0;">Suchbaum Visualisierung</h3>
        <div style="background:#34495e; color:white; padding:0.5rem; font-size:0.85rem; margin-bottom:0.5rem;">
            <strong>Einstellung:</strong> Level 1
        </div>
        <div style="margin-bottom:0.5rem;">
            <button id="btn0" class="lp-btn" style="padding:0.3rem 0.5rem; font-size:0.85rem;" onclick="setDepth(0)">0</button>
            <button id="btn1" class="lp-btn" style="padding:0.3rem 0.5rem; font-size:0.85rem;" onclick="setDepth(1)">1</button>
            <button id="btn2" class="lp-btn" style="padding:0.3rem 0.5rem; font-size:0.85rem;" onclick="setDepth(2)">2</button>
            <button id="btn3" class="lp-btn" style="padding:0.3rem 0.5rem; font-size:0.85rem;" onclick="setDepth(3)">3</button>
            <button id="btn4" class="lp-btn" style="padding:0.3rem 0.5rem; font-size:0.85rem;" onclick="setDepth(4)">4</button>
        </div>
        <iframe id="vizFrame" src="../../playground/rotatebox-viz.html?level=1&maxDepth=1&duplicates=false&hideControls=true&autoFitZoom=true&showOverlay=false" style="width:100%; height:calc(100% - 120px); border:1px solid #ddd; border-radius:4px;"></iframe>
    </div>
    
    <!-- Middle Column: Table & Formulas -->
    <div class="col-middle">
        <h2 style="margin-top:0;">Komplexität von Binärbäumen</h2>
        
        <p>Fülle die Tabelle aus. Beobachte, wie schnell die Zahlen wachsen!</p>
        
        <table class="complexity-table" id="complexityTable">
            <thead>
                <tr>
                    <th>Ebene (k)</th>
                    <th>Knoten auf Ebene</th>
                    <th>Gesamt Knoten</th>
                </tr>
            </thead>
            <tbody>
                <tr><td>0</td><td>1</td><td>1</td></tr>
                <tr><td>1</td><td>2</td><td>3</td></tr>
                <tr><td>2</td><td>4</td><td>7</td></tr>
                <tr><td>3</td><td><input type="number" data-answer="8"></td><td><input type="number" data-answer="15"></td></tr>
                <tr><td>4</td><td><input type="number" data-answer="16"></td><td><input type="number" data-answer="31"></td></tr>
                <tr><td>5</td><td><input type="number" data-answer="32"></td><td><input type="number" data-answer="63"></td></tr>
                <tr><td>6</td><td><input type="number" data-answer="64"></td><td><input type="number" data-answer="127"></td></tr>
                <tr><td>7</td><td><input type="number" data-answer="128"></td><td><input type="number" data-answer="255"></td></tr>
                <tr><td>8</td><td><input type="number" data-answer="256"></td><td><input type="number" data-answer="511"></td></tr>
            </tbody>
        </table>
        
        <!-- Formulas (shown after table is complete) -->
        <div id="formulaSection" class="formula-section" style="display:none;">
            <h3>Erkennst du ein Muster?</h3>
            <p>Finde die Formeln für die Anzahl der Knoten:</p>
            
            <div style="margin:1rem 0;">
                <strong>Knoten auf Ebene k:</strong><br>
                <input type="text" class="formula-input" id="formula1" placeholder="Formel eingeben">
                <span id="formula1-feedback"></span>
            </div>
            
            <div style="margin:1rem 0;">
                <strong>Gesamt Knoten bis Ebene k:</strong><br>
                <input type="text" class="formula-input" id="formula2" placeholder="Formel eingeben">
                <span id="formula2-feedback"></span>
            </div>
            
            <button id="helpBtn" class="lp-btn" style="margin-top:1rem;">Hilfe</button>
            <div id="helpText" style="display:none; margin-top:1rem; padding:1rem; background:#fff3cd; border-radius:4px;"></div>
        </div>
        
        <!-- Extended rows (shown after formulas) -->
        <div id="extendedSection" style="display:none; margin-top:2rem;">
            <h3>Wende die Formeln an:</h3>
            <table class="complexity-table">
                <thead>
                    <tr><th>Ebene (k)</th><th>Knoten auf Ebene</th><th>Gesamt Knoten</th></tr>
                </thead>
                <tbody>
                    <tr><td>22</td><td><input type="number" data-answer="4194304" id="ext1"></td><td><input type="number" data-answer="8388607" id="ext2"></td></tr>
                </tbody>
            </table>
            <button id="extHelpBtn" class="lp-btn" style="margin-top:1rem;">Hilfe für Ebene 22</button>
        </div>
        
        <div id="task-status" class="lp-block" style="display:none; background:#e8f5e9; border-left:4px solid #4caf50; margin-top:2rem;">
            <p style="margin:0; color:#2e7d32;"><strong>✓ Aufgabe erfüllt!</strong><br>Alle Aufgaben korrekt gelöst!</p>
        </div>
        
        <div class="lp-navigation" style="margin-top:2rem;"></div>
    </div>
    
    <!-- Right Column: Explanation -->
    <div class="col-right">
        <h3 style="margin-top:0;">Erklärung</h3>
        <div class="lp-block">
            <p><strong>Beobachtung:</strong> Jede Ebene hat doppelt so viele Knoten wie die vorherige.</p>
            <p>Das ist <em>exponentielles Wachstum</em>!</p>
        </div>
        <div class="lp-block" style="margin-top:1rem; background:#fff3cd;">
            <p style="margin:0;"><strong>Wichtig:</strong> Die Anzahl der Knoten wächst sehr schnell. Bei Tiefe 10 haben wir bereits über 1000 Knoten!</p>
        </div>
    </div>
    
</div>

<script>
window.COURSE_DATA = {"id":"search-trees-rotatebox","title":"Suchbäume mit RotateBox verstehen","description":"Lerne wie Computer komplexe Rätsel lösen, indem wir das Spiel RotateBox untersuchen.","author":"Alexander Wolf","version":"1.0","lessons":[{"id":"intro","title":"Einführung: Wie löst eine KI Rätsel?","file":"00_intro.html","type":"intro"},{"id":"game-basics","title":"Das Spiel und die Interaktion","file":"01_game.html","type":"practice"},{"id":"puzzle-challenge","title":"Rätseln mit Hilfe","file":"02_puzzle.html","type":"practice"},{"id":"ai-intro","title":"Der Computer hilft","file":"03_ai.html","type":"interactive"},{"id":"tree-basics","title":"Der Suchbaum","file":"04_tree_1.html","type":"theory"},{"id":"tree-growth","title":"Der Suchbaum wächst","file":"05_tree_2.html","type":"theory"},{"id":"complexity","title":"Komplexität von Binärbäumen","file":"06_complexity.html","type":"math"},{"id":"limits","title":"Wir sprengen den Algorithmus","file":"07_limits.html","type":"advanced"},{"id":"duplicates","title":"Die Auswirkung von Doppelungen","file":"08_duplicates.html","type":"theory"},{"id":"final-quiz","title":"Abschlussquiz","file":"09_quiz.html","type":"quiz"}]};
</script>
<script src="../../js/learning-path.js"></script>
<script>
    let tableComplete = false;
    let formulasCorrect = false;
    let extendedComplete = false;
    let helpClicks = 0;
    let extHelpClicks = 0;
    
    // Table validation
    const inputs = document.querySelectorAll('#complexityTable input');
    inputs.forEach(inp => {
        inp.addEventListener('input', () => {
            if (inp.value == inp.dataset.answer) {
                inp.classList.add('correct');
            } else {
                inp.classList.remove('correct');
            }
            checkTableComplete();
        });
    });
    
    function checkTableComplete() {
        const allCorrect = Array.from(inputs).every(inp => inp.value == inp.dataset.answer);
        if (allCorrect && !tableComplete) {
            tableComplete = true;
            document.getElementById('formulaSection').style.display = 'block';
        }
    }
    
    // Formula validation
    const formula1 = document.getElementById('formula1');
    const formula2 = document.getElementById('formula2');
    
    function checkFormula(input, correctAnswers, feedbackEl) {
        const val = input.value.trim().toLowerCase().replace(/\s/g, '');
        const isCorrect = correctAnswers.some(ans => val === ans);
        if (isCorrect) {
            feedbackEl.textContent = ' ✓';
            feedbackEl.style.color = 'green';
            input.style.borderColor = 'green';
            input.style.background = '#e8f5e9';
            return true;
        } else if (val.length > 0) {
            feedbackEl.textContent = ' Versuche es nochmal';
            feedbackEl.style.color = 'orange';
        }
        return false;
    }
    
    formula1.addEventListener('input', () => {
        const correct = checkFormula(formula1, ['2^k', '2**k', 'pow(2,k)'], document.getElementById('formula1-feedback'));
        checkFormulasComplete();
    });
    
    formula2.addEventListener('input', () => {
        const correct = checkFormula(formula2, ['2^k-1', '2**k-1', 'pow(2,k)-1', '2^(k+1)-1'], document.getElementById('formula2-feedback'));
        checkFormulasComplete();
    });
    
    function checkFormulasComplete() {
        const f1 = formula1.value.trim().toLowerCase().replace(/\s/g, '');
        const f2 = formula2.value.trim().toLowerCase().replace(/\s/g, '');
        const f1ok = ['2^k', '2**k', 'pow(2,k)'].includes(f1);
        const f2ok = ['2^k-1', '2**k-1', 'pow(2,k)-1', '2^(k+1)-1'].includes(f2);
        if (f1ok && f2ok && !formulasCorrect) {
            formulasCorrect = true;
            document.getElementById('extendedSection').style.display = 'block';
        }
    }
    
    // Help button
    document.getElementById('helpBtn').addEventListener('click', () => {
        helpClicks++;
        const helpText = document.getElementById('helpText');
        helpText.style.display = 'block';
        if (helpClicks === 1) {
            helpText.innerHTML = '<strong>Hinweis 1:</strong> Schau dir an, wie sich die Zahlen in den Spalten entwickeln. Verdoppeln sie sich?';
        } else if (helpClicks === 2) {
            helpText.innerHTML = '<strong>Hinweis 2:</strong> Die "Knoten auf Ebene" verdoppeln sich jede Ebene. Das ist 2 hoch k.<br>Die "Gesamt Knoten" sind immer 1 weniger als die nächste Potenz von 2.';
        } else {
            helpText.innerHTML = '<strong>Lösung:</strong><br>Knoten auf Ebene k: <code>2^k</code><br>Gesamt Knoten: <code>2^(k+1) - 1</code> oder <code>2^k - 1</code> (je nach Konvention)';
            formula1.value = '2^k';
            formula2.value = '2^k-1';
            formula1.dispatchEvent(new Event('input'));
            formula2.dispatchEvent(new Event('input'));
        }
    });
    
    // Extended section validation
    const ext1 = document.getElementById('ext1');
    const ext2 = document.getElementById('ext2');
    
    [ext1, ext2].forEach(inp => {
        inp.addEventListener('input', () => {
            if (inp.value == inp.dataset.answer) {
                inp.classList.add('correct');
            } else {
                inp.classList.remove('correct');
            }
            checkExtendedComplete();
        });
    });
    
    function checkExtendedComplete() {
        const allCorrect = [ext1, ext2].every(inp => inp.value == inp.dataset.answer);
        if (allCorrect && !extendedComplete) {
            extendedComplete = true;
            document.getElementById('task-status').style.display = 'block';
            if (window.learningPath) {
                window.learningPath.enableNextButton();
            }
        }
    }
    
    // Extended help
    document.getElementById('extHelpBtn').addEventListener('click', () => {
        extHelpClicks++;
        if (extHelpClicks === 1) {
            alert('Tipp: Verwende die Formeln!\n2^22 = ' + Math.pow(2, 22) + '\n2^22 - 1 = ' + (Math.pow(2, 22) - 1));
        } else if (extHelpClicks === 2) {
            alert('Du kannst einen Taschenrechner verwenden:\n2^22 = 4194304\n2^23 - 1 = 8388607');
        } else {
            // Fill in answers
            ext1.value = ext1.dataset.answer;
            ext2.value = ext2.dataset.answer;
            ext1.dispatchEvent(new Event('input'));
            ext2.dispatchEvent(new Event('input'));
        }
    });
    
    // Depth button function
    function setDepth(depth) {
        document.getElementById('vizFrame').contentWindow.postMessage({
            type: 'UPDATE_PARAMS',
            level: 1,
            maxDepth: depth,
            duplicates: false
        }, '*');
    }
</script>
</body>
</html>
